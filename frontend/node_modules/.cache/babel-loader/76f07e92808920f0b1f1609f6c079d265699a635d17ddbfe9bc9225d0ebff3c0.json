{"ast":null,"code":"import _regeneratorRuntime from\"/Users/mkkbnv/go/src/grpc-react-web/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/mkkbnv/go/src/grpc-react-web/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _classCallCheck from\"/Users/mkkbnv/go/src/grpc-react-web/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/mkkbnv/go/src/grpc-react-web/frontend/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/mkkbnv/go/src/grpc-react-web/frontend/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/mkkbnv/go/src/grpc-react-web/frontend/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React,{Component}from'react';import{Input,Button,Modal}from'antd';import{AccessClient}from'../jsclient/echo_grpc_web_pb';import{EntranceRequest}from'../jsclient/echo_pb';import\"../App.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ModalFooter=function ModalFooter(_ref){var onClose=_ref.onClose,isAuth=_ref.isAuth;return/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',margin:'0 auto'},children:/*#__PURE__*/_jsx(Button,{type:\"primary\",onClick:onClose,danger:!isAuth,children:isAuth?'Authorized':'Not Authorized'})});};var Entrance=/*#__PURE__*/function(_Component){_inherits(Entrance,_Component);var _super=_createSuper(Entrance);function Entrance(props){var _this;_classCallCheck(this,Entrance);_this=_super.call(this,props);_this.handleTextChange=function(event){_this.setState({Id:event.target.value});};_this.startCamera=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var stream;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return navigator.mediaDevices.getUserMedia({video:true});case 3:stream=_context.sent;_this.setState({videoStream:stream});_this.videoRef.current.srcObject=stream;_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);console.error('Error accessing camera:',_context.t0);case 11:case\"end\":return _context.stop();}},_callee,null,[[0,8]]);}));_this.stopCamera=function(){var videoStream=_this.state.videoStream;if(videoStream){videoStream.getTracks().forEach(function(track){return track.stop();});// setState -> useState => [value, setValue]\n// setVideoStream(null)\n_this.setState({videoStream:null});}};_this.closeModal=function(){_this.setState({isModalOpen:false});};_this.handleSendRequest=function(){var Id=_this.state.Id;var videoElement=_this.videoRef.current;if(videoElement){var canvas=document.createElement('canvas');canvas.width=videoElement.videoWidth;canvas.height=videoElement.videoHeight;canvas.getContext('2d').drawImage(videoElement,0,0,canvas.width,canvas.height);canvas.toBlob(function(blob){var reader=new FileReader();reader.onload=function(){var imageBytes=new Uint8Array(reader.result);var timestamp=Date.now();var uniqueIdentifier=Math.random().toString(36).substring(7);var url=window.location.protocol+'//'+window.location.hostname;var client=new AccessClient(\"\".concat(url,\":8080\"),null,null);var request=new EntranceRequest();request.setId(Id);request.setFileName(\"\".concat(Id,\"_\").concat(timestamp,\"_\").concat(uniqueIdentifier,\".jpg\"));request.setChunk(imageBytes);client.accessCheck(request,{},function(err,response){if(!err){var responseText=response.getAccess();_this.setState({isModalOpen:true});console.log('Response:',responseText);_this.setState({responseText:responseText,isModalOpen:true});}else{console.error('Error:',err);}});};reader.readAsArrayBuffer(blob);});}else{console.error('Camera not started.');}};_this.state={Id:'',videoStream:null,responseText:'',isModalOpen:false};_this.videoRef=/*#__PURE__*/React.createRef();return _this;}_createClass(Entrance,[{key:\"componentDidMount\",value:function componentDidMount(){// useEffect\nthis.startCamera();}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){// useEffect\nthis.stopCamera();}},{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/_jsxs(\"div\",{className:\"top-margin\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Button,{type:\"primary\",block:true,onClick:this.handleSendRequest,children:\"Get access\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Input,{className:\"input-text\",type:\"text\",placeholder:\"Enter ID\",value:this.state.Id,onChange:this.handleTextChange})]}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"video\",{className:\"camera-caption\",ref:this.videoRef,autoPlay:true})}),/*#__PURE__*/_jsx(Modal,{title:\"Access\",open:this.state.isModalOpen,onCancel:this.closeModal,footer:function footer(){return/*#__PURE__*/_jsx(ModalFooter,{onClose:_this2.closeModal,isAuth:_this2.state.responseText});},children:/*#__PURE__*/_jsx(\"p\",{children:this.state.responseText?'Welcome ...':'Not allowed'})})]});}}]);return Entrance;}(Component);export default Entrance;","map":{"version":3,"names":["React","Component","Input","Button","Modal","AccessClient","EntranceRequest","jsx","_jsx","jsxs","_jsxs","ModalFooter","_ref","onClose","isAuth","style","textAlign","margin","children","type","onClick","danger","Entrance","_Component","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","handleTextChange","event","setState","Id","target","value","startCamera","_asyncToGenerator","_regeneratorRuntime","mark","_callee","stream","wrap","_callee$","_context","prev","next","navigator","mediaDevices","getUserMedia","video","sent","videoStream","videoRef","current","srcObject","t0","console","error","stop","stopCamera","state","getTracks","forEach","track","closeModal","isModalOpen","handleSendRequest","videoElement","canvas","document","createElement","width","videoWidth","height","videoHeight","getContext","drawImage","toBlob","blob","reader","FileReader","onload","imageBytes","Uint8Array","result","timestamp","Date","now","uniqueIdentifier","Math","random","toString","substring","url","window","location","protocol","hostname","client","concat","request","setId","setFileName","setChunk","accessCheck","err","response","responseText","getAccess","log","readAsArrayBuffer","createRef","_createClass","key","componentDidMount","componentWillUnmount","render","_this2","className","block","placeholder","onChange","ref","autoPlay","title","open","onCancel","footer"],"sources":["/Users/mkkbnv/go/src/grpc-react-web/frontend/src/pages/entrance.js"],"sourcesContent":["import React, { Component } from 'react';\nimport { Input, Button, Modal } from 'antd';\n\nimport { AccessClient } from '../jsclient/echo_grpc_web_pb';\nimport { EntranceRequest } from '../jsclient/echo_pb';\nimport \"../App.css\";\n\nconst ModalFooter = ({ onClose, isAuth }) => (\n  <div style={{  textAlign: 'center', margin: '0 auto' }}>\n    <Button type=\"primary\" onClick={onClose} danger={!isAuth}>\n      {isAuth ? 'Authorized' : 'Not Authorized'}\n    </Button>\n  </div>\n);\n\nclass Entrance extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      Id: '',\n      videoStream: null,\n      responseText: '',\n      isModalOpen: false,\n    };\n    this.videoRef = React.createRef();\n  }\n\n  handleTextChange = (event) => {\n    this.setState({ Id: event.target.value });\n  };\n\n  startCamera = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({ video: true });\n      this.setState({ videoStream: stream });\n      this.videoRef.current.srcObject = stream;\n    } catch (error) {\n      console.error('Error accessing camera:', error);\n    }\n    \n  };\n\n  stopCamera = () => {\n    const { videoStream } = this.state;\n    if (videoStream) {\n      videoStream.getTracks().forEach((track) => track.stop());\n    // setState -> useState => [value, setValue]\n    // setVideoStream(null)\n\n      this.setState({ videoStream: null });\n    }\n  };\n\n  closeModal = () => {\n    this.setState({ isModalOpen: false });\n  }\n\n  handleSendRequest = () => {\n    const { Id } = this.state;\n    const videoElement = this.videoRef.current;\n\n    if (videoElement) {\n      const canvas = document.createElement('canvas');\n      canvas.width = videoElement.videoWidth;\n      canvas.height = videoElement.videoHeight;\n      canvas.getContext('2d').drawImage(videoElement, 0, 0, canvas.width, canvas.height);\n      canvas.toBlob((blob) => {\n        const reader = new FileReader();\n        reader.onload = () => {\n          const imageBytes = new Uint8Array(reader.result);\n          var timestamp = Date.now(); \n          var uniqueIdentifier = Math.random().toString(36).substring(7);\n          const url = window.location.protocol + '//' + window.location.hostname;\n          const client = new AccessClient(`${url}:8080`, null, null);\n          const request = new EntranceRequest();\n          request.setId(Id);\n          request.setFileName(`${Id}_${timestamp}_${uniqueIdentifier}.jpg`);\n          request.setChunk(imageBytes);\n\n          client.accessCheck(request, {}, (err, response) => {\n            if (!err) {\n              const responseText = response.getAccess();\n              this.setState({ isModalOpen: true});\n              console.log('Response:', responseText);\n              this.setState({ responseText: responseText, isModalOpen: true });\n            } else {\n              console.error('Error:', err);\n            }\n          });\n        };\n        reader.readAsArrayBuffer(blob);\n      });\n    } else {\n      console.error('Camera not started.');\n    }\n  };\n\n  componentDidMount() {\n    // useEffect\n    this.startCamera();\n  }\n\n  componentWillUnmount() {\n    // useEffect\n\n    this.stopCamera();\n  }\n\n  render() {\n    return (\n      <div className=\"top-margin\">\n        <div>\n          <Button type=\"primary\" block onClick={this.handleSendRequest}>Get access</Button>\n          <br /><br />\n          <Input  className=\"input-text\"\n            type=\"text\"\n            placeholder=\"Enter ID\"\n            value={this.state.Id}\n            onChange={this.handleTextChange}\n          />\n        </div>\n        <div>\n          <video className=\"camera-caption\" ref={this.videoRef} autoPlay />\n        </div>\n        <Modal \n          title=\"Access\" \n          open={this.state.isModalOpen} \n          onCancel={this.closeModal}\n          footer={() => <ModalFooter onClose={this.closeModal} isAuth={this.state.responseText} />}\n        >\n          <p>{this.state.responseText ? 'Welcome ...' : 'Not allowed'}</p>\n        </Modal>\n      </div>\n    );\n  }\n}\n\nexport default Entrance;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}